<div ng-controller="CategController as categCtrl">
    <nav class="navbar sticky-top navbar-light justify-content-between d-flex flex-wrap" style="background-color: white;">
        <div class="navbar-brand">
            <img src="images/logo.jpeg" width="100" alt="logo">
        </div>
        <div>
            <button class="btn btn-outline-primary me-2" ui-sref="admin">Dashboard</button>
            <button class="btn btn-outline-primary me-2" ui-sref="category">Categories</button>
            <button class="btn btn-outline-primary" ui-sref="order">Order Details</button>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">Category Management</h4>
                        <button class="btn btn-light" type="button" data-toggle="collapse" data-target="#addCategoryForm" aria-expanded="false" aria-controls="addCategoryForm">
                            Add Category
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="collapse mb-4" id="addCategoryForm">
                            <form id="categoryForm" name="addCategoryForm" ng-submit="categCtrl.addCategory()" enctype="multipart/form-data">
                                <div class="form-group mb-2">
                                    <label for="category-name">Name:</label>
                                    <input type="text" class="form-control" id="category-name" ng-model="categCtrl.newCategory.name" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="category-description">Description:</label>
                                    <textarea class="form-control" id="category-description" ng-model="categCtrl.newCategory.description" required></textarea>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="category-image">Image:</label>
                                    <input type="file" class="form-control" id="category-image" accept="image/*" onchange="angular.element(this).scope().categCtrl.img(this)" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Add Category</button>
                            </form>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-striped table-sm">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="category in categCtrl.categories" id="{{category.category_id}}">
                                        <td>
                                            <img ng-src="{{categCtrl.getImageUrl(category.category_image)}}" alt="{{category.category_name}}" style="width: 50px; height: 50px; object-fit: cover;">
                                        </td>
                                        <td>{{category.category_name}}</td>
                                        <td>{{category.category_description | limitTo: 50}}{{category.category_description.length > 50 ? '...' : ''}}</td>
                                        <td>
                                            <button class="btn btn-sm btn-success me-1" ng-click="categCtrl.fetchProducts(category); categCtrl.currentCategoryId = category.id; categCtrl.currentCategoryName = category.category_name">View Products</button>
                                            <button class="btn btn-sm btn-danger" ng-click="categCtrl.deleteCategory(category.id)">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">Product Management</h4>
                        <button class="btn btn-light" type="button" data-toggle="collapse" data-target="#addProductForm" aria-expanded="false" aria-controls="addProductForm">
                            Add Product
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="collapse mb-4" id="addProductForm">
                            <form id="productForm" name="addProductForm" ng-submit="categCtrl.addProduct()" enctype="multipart/form-data">
                                <div class="form-group mb-2">
                                    <label for="product-name">Name:</label>
                                    <input type="text" class="form-control" id="product-name" ng-model="categCtrl.newProduct.name" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="product-description">Description:</label>
                                    <textarea class="form-control" id="product-description" ng-model="categCtrl.newProduct.description" required></textarea>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="product-image">Image:</label>
                                    <input type="file" class="form-control" id="product-image" accept="image/*" onchange="angular.element(this).scope().categCtrl.productImg(this)" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="product-price">Price:</label>
                                    <input type="number" class="form-control" id="product-price" ng-model="categCtrl.newProduct.price" required>
                                </div>
                                <div class="form-group mb-2">
                                    <label for="product-quantity">Quantity:</label>
                                    <input type="number" class="form-control" id="product-quantity" ng-model="categCtrl.newProduct.quantity" required>
                                </div>
                                <button type="submit" class="btn btn-success" ng-disabled="!categCtrl.currentCategoryId">Add</button>
                            </form>
                        </div>
                        
                        <h5>Product List <span ng-if="categCtrl.currentCategoryId">For {{categCtrl.currentCategoryName}}</span></h5>
                        <div class="table-responsive">
                            <table class="table table-striped table-sm">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Price</th>
                                        <th>Quantity</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="product in categCtrl.products" id="{{product.id}}">
                                        <td>
                                            <img ng-src="{{categCtrl.getImageUrl(product.product_image)}}" alt="{{product.product_name}}" style="width: 50px; height: 50px; object-fit: cover;">
                                        </td>
                                        <td>{{product.product_name}}</td>
                                        <td>{{product.description}}</td>
                                        <td>Rs.{{product.price_by_quantity}}</td>
                                        <td>{{product.stock_keeping_unit}}</td>
                                        <td>
                                            <button class="btn btn-sm btn-danger" ng-click="categCtrl.deleteProduct(product.id)">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <!-- <section id="order-details" ng-show="admCtrl.currentSection === 'order'">
        <h2 class="mb-4">Order Details</h2>
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th scope="col">Order ID</th>
                        <th scope="col">Customer</th>
                        <th scope="col">Date</th>
                        <th scope="col">Total</th>
                        <th scope="col">Status</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="order in admCtrl.orders">
                        <td>{{order.id}}</td>
                        <td>{{order.customer_name}}</td>
                        <td>{{order.date | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                        <td>{{order.total | currency}}</td>
                        <td>{{order.status}}</td>
                        <td>
                            <button class="btn btn-sm btn-primary me-1" ng-click="admCtrl.viewOrderDetails(order.id)">View</button>
                            <button class="btn btn-sm btn-warning" ng-click="admCtrl.updateOrderStatus(order.id)">Update Status</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section> -->


